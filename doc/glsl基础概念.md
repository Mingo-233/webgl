## webgl渲染管线流程

1 js提供数据-》顶点数据
2 顶点着色器-》绘制顶点位置
3 图元装配-》将顶点装配成三角形
4 光栅化-》用像素填充三角形（出现轮廓
5 片元着色器-》用颜色填充像素

## 术语

图元：WebGL 能够绘制的基本图形元素，包含三种：点、线段、三角形。

片元：可以理解为像素，像素着色阶段是在片元着色器中。


裁剪坐标系：裁剪坐标系是顶点着色器中的 gl\_Position 内置变量接收到的坐标所在的坐标系。


设备坐标系：又名 NDC 坐标系，是裁剪坐标系各个分量对 w 分量相除得到的坐标系，特点是 x、y、z 坐标分量的取值范围都在 【-1，1】之间，可以将它理解为边长为 2 的正方体，坐标系原点在正方体中心。

WebGL 的基本图元包含点、线段、三角形，而三角形又分为三类，基本三角形，三角带，三角扇。

线段又分为三类LINES：基本线段、LINE_STRIP：带状线段、LINE_LOOP：环状线段。

## api

*   gl\_Position、gl\_PointSize、gl\_FragColor 是 GLSL 的内置属性。

    *   gl\_Position：顶点的`裁剪坐标系坐标`，包含 X, Y, Z，W 四个坐标分量，顶点着色器接收到这个坐标之后，对它进行透视除法，即将各个分量同时除以 W，转换成 `NDC 坐标`，NDC 坐标每个分量的取值范围都在【-1, 1】之间，GPU 获取这个属性值作为顶点的最终位置进行绘制。
    *   gl\_FragColor：片元（像素）颜色，包含 R, G, B, A 四个颜色分量，且每个分量的取值范围在【0,1】之间，GPU 获取这个值作为像素的最终颜色进行着色。
    *   gl\_PointSize：绘制到屏幕的点的大小，需要注意的是，gl\_PointSize只有在绘制图元是`点`的时候才会生效。当我们绘制线段或者三角形的时候，gl\_PointSize是不起作用的。
*   vec4：包含四个浮点元素的`容器类型`，vec 是 vector（向量）的单词简写，vec4 代表包含 4 个浮点数的向量。此外，还有 `vec2`、`vec3` 等类型，代表包含`2个`或者`3个`浮点数的容器。
*   GLSL 中 gl\_Position 所接收的坐标所在坐标系是裁剪坐标系 ，不同于我们的浏览器窗口坐标系。所以当我们赋予 gl\_Position 位置信息的时候，需要对其进行转换才能正确显示。
*   gl\_FragColor，属于 GLSL 内置属性，用来设置片元颜色，包含 4 个分量 (R, G, B, A)，各个颜色分量的取值范围是【0，1】，也不同于我们常规颜色的【0，255】取值范围，所以当我们给 gl\_FragColor 赋值时，也需要对其进行转换。平常我们所采用的颜色值（R, G, B, A），对应的转换公式为： (R值/255，G值/255，B值/255，A值/1）。拿红色举例，在CSS中，红色用 `RGBA` 形式表示是（255，0，0，1），那么转换成 GLSL 形式就是(255 / 255, 0 / 255, 0 / 255, 1 / 1)，转换后的值为（1.0, 0.0, 0.0, 1.0)。

### gl.vertexAttribPointer (target, size, type, normalize, stride, offset)。
target： 允许哪个属性读取当前缓冲区的数据。
size：一次取几个数据赋值给 target 指定的目标属性。在我们的示例中，顶点着色器中 a_Position 是 vec2 类型，即每次接收两个数据，所以 size 设置为 2。以后我们绘制立体模型的时候，a_Position 会接收三个数据，size 相应地也会设置成 3。
type：数据类型，一般而言都是浮点型。
normalize：是否需要将非浮点类型数据单位化到【-1, 1】区间。
stride：步长，即每个顶点所包含数据的字节数，默认是 0 ，0 表示一个属性的数据是连续存放的。在我们的例子中，我们的一个顶点包含两个分量，X 坐标和 Y 坐标，每个分量都是一个 Float32 类型，占 4 个字节，所以，stride = 2 * 4 = 8 个字节。但我们的例子中，缓冲区只为一个属性a_Position服务，缓冲区的数据是连续存放的，因此我们可以使用默认值 0 来表示。但如果我们的缓冲区为多个属性所共用，那么 stride 就不能设置为 0 了，需要进行计算。
offset：在每个步长的数据里，目标属性需要偏移多少字节开始读取。在我们的例子中，buffer 只为 a_Position 一个属性服务，所以 offset 为 0 * 4 = 0。

## 变量申明
attribue 变量：只能在顶点着色器中定义。

uniform 变量：既可以在顶点着色器中定义，也可以在片元着色器中定义。

最后一种变量类型 varing 变量：它用来从顶点着色器中往片元着色器传递数据。使用它我们可以在顶点着色器中声明一个变量并对其赋值，经过插值处理后，在片元着色器中取出插值后的值来使用

### gl.drawArrays 的语法
void gl.drawArrays(mode, first, count);
参数：
mode，代表图元类型。
first，代表从第几个点开始绘制。
count，代表绘制的点的数量

### GLSL：着色器
#### 数据类型
vec2：2 维向量容器。
vec4：4 维向量容器。
运算法则：向量与向量、向量与浮点数的运算法则。
#### 修饰符
attribute：属性修饰符。
uniform：全局变量修饰符。
varying：顶点着色器传递给片元着色器的属性修饰符。
precision：设置精度
highp：高精度。
mediump：中等精度。
lowp：低精度。
#### 内置变量
gl_Position：顶点坐标。
gl_FragColor：片元颜色。
gl_PointSize：顶点大小。
#### 屏幕坐标系到设备坐标系的转换。
屏幕坐标系左上角为原点，X 轴坐标向右为正，Y 轴坐标向下为正。
坐标范围：
X轴：【0, canvas.width】
Y轴：【0, canvas.height】
设备坐标系以屏幕中心为原点，X 轴坐标向右为正，Y 轴向上为正。
坐标范围是
X轴：【-1, 1】。
Y轴：【-1, 1】。
### WebGL API
####  shader：着色器对象
gl.createShader：创建着色器。
gl.shaderSource：指定着色器源码。
gl.compileShader：编译着色器。
#### program：着色器程序
gl.createProgram：创建着色器程序。
gl.attachShader：链接着色器对象。
gl.linkProgram：链接着色器程序。
gl.useProgram：使用着色器程序。
#### attribute：着色器属性
gl.getAttribLocation：获取顶点着色器中的属性位置。
gl.enableVertexAttribArray：启用着色器属性。
gl.vertexAttribPointer：设置着色器属性读取 buffer 的方式。
gl.vertexAttrib2f：给着色器属性赋值，值为两个浮点数。
gl.vertexAttrib3f：给着色器属性赋值，值为三个浮点数。
#### uniform：着色器全局属性
gl.getUniformLocation：获取全局变量位置。
gl.uniform4f：给全局变量赋值 4 个浮点数。
gl.uniform1i：给全局变量赋值 1 个整数。
#### buffer：缓冲区
gl.createBuffer：创建缓冲区对象。
gl.bindBuffer：将缓冲区对象设置为当前缓冲。
gl.bufferData：向当前缓冲对象复制数据。
#### clear：清屏
gl.clearColor：设置清除屏幕的背景色。
gl.clear：清除屏幕。
#### draw：绘制
gl.drawArrays：数组绘制方式。
gl.drawElements：索引绘制方式。
#### 图元
gl.POINTS：点。
gl.LINE：基本线段。
gl.LINE_STRIP：连续线段。
gl.LINE_LOOP：闭合线段。
gl.TRIANGLES：基本三角形。
gl.TRIANGLE_STRIP：三角带。
gl.TRIANGLE_FAN：三角扇。
#### 纹理
gl.createTexture：创建纹理对象。
gl.activeTexture：激活纹理单元。
gl.bindTexture：绑定纹理对象到当前纹理。
gl.texImage2D：将图片数据传递给 GPU。
gl.texParameterf：设置图片放大缩小时的过滤算法。
## 补充知识

### 我可以去哪里查到关于shader-source的定义

shader-source 不是一个标准的HTML属性，而是一个自定义属性，因此它的定义可能是特定于某个应用程序或库的。在您的例子中，它似乎是用于将着色器源代码嵌入HTML文档中的技术。

如果您想查看关于 shader-source 的更多信息，我建议您检查使用它的应用程序或库的文档或教程。您可以尝试在搜索引擎中搜索关于 shader-source 的相关文档或文章，以便了解更多信息。

### 什么是ndc坐标系
"NDC" 指的是归一化设备坐标(Normalized Device Coordinates)，是在3D图形学中使用的一种坐标系。NDC坐标系是在透视除法后将视景体的所有顶点坐标映射到一个标准的正方形空间内（通常是以 (-1,-1) 为左下角，(1,1) 为右上角的正方形），该过程称为“规范化”。在这个标准空间中，所有可见的三角形都可以进行裁剪和光栅化处理，以在屏幕上绘制出2D图像。

在NDC坐标系中，x、y和z分量的值范围都是[-1,1]，这是通过将世界坐标系中的点乘以一个透视投影矩阵来实现的。其中，x和y分量直接被缩放，而z分量则经过透视除法计算。这个过程可以通过OpenGL或WebGL等图形库中的视图和投影变换来实现，以便将三维场景呈现在二维屏幕上

### 裁剪坐标系和浏览器窗口坐标系和ndc坐标系之间的关系
裁剪坐标系，浏览器窗口坐标系和NDC坐标系是在WebGL中使用的三个坐标系。它们的关系如下：

裁剪坐标系： 在WebGL中，顶点着色器生成的顶点坐标位于裁剪坐标系中。在这个坐标系中，所有的顶点坐标都是以相对于相机视角的中心点的距离来定义的。因此，裁剪坐标系中的坐标值可能为正或负，这取决于物体的位置和相机的朝向。在图形渲染管线中，几何图形经过一系列变换后，最终被映射到屏幕上。这些变换包括模型变换、视图变换和投影变换。在投影变换之后，得到的是裁剪坐标系中的坐标。裁剪坐标系是一个以原点为中心的立方体，它的范围为[-1,1]。超出这个范围的坐标会被裁剪掉，不参与后续渲染。

NDC坐标系：裁剪坐标系中的坐标需要进行透视除法，将坐标映射到NDC坐标系中。透视除法是通过将裁剪坐标系中的坐标除以它们的齐次分量来实现的。齐次坐标是一种4D坐标，用于表示3D坐标和缩放因子。 透视除法后，得到的NDC坐标系中的坐标范围也是[-1,1]，并且原点位于屏幕中心。NDC坐标系是一个虚拟坐标系，所有的坐标都在这个坐标系中表示，不管它们在屏幕上的实际位置。最终，NDC坐标系中的坐标会被映射到屏幕上的像素坐标，完成图形渲染的过程。

浏览器窗口坐标系： 在片元着色器中，NDC坐标系的坐标被变换到浏览器窗口坐标系。在这个坐标系中，x轴和y轴的坐标值对应于屏幕上的像素值。WebGL会自动将NDC坐标系中的坐标映射到浏览器窗口坐标系中，以便正确绘制到屏幕上。


个人理解：一个三维模型生成，根据相机的位置，这个物体投影在一个面，这个面就是裁剪坐标系的面，为了保证三维在二维平面的呈现，引入透视法，呈现在ndc坐标系上，最后位置一一对应在显示器的平面上，也就是窗口坐标系。